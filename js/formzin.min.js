/* ========================================================================
 * Formzin: formzin.js v0.2
 * http://brunobrasilweb.github.io/Formzin.js
 * ========================================================================
 * Copyright (c) 2013 @brunobrasilweb.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * thtp://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================================== */
var Formzin={iniciar:function(){jQuery(document).ready(function(){Formzin.formatar(jQuery(".cpf"),"000.000.000-00");Formzin.formatar(jQuery(".cnpj"),"00.000.000/0000-00");Formzin.formatar(jQuery(".cep"),"00000-000");Formzin.formatar(jQuery(".telefone"),"(00) 0000-00000");Formzin.formatar(jQuery(".cartao_credito"),"0000 0000 0000 0000");Formzin.formatar(jQuery(".inteiro"),"inteiro");Formzin.formatar(jQuery(".mascara"),"mascara");Formzin.formatar(jQuery(".caixa_alta"),"caixa_alta");Formzin.formatar(jQuery(".data"),"data");Formzin.formatar(jQuery(".placa_carro"),"SSS 0000");Formzin.formatar(jQuery(".codigo_rastreio"),"SS000000000SS");Formzin.fMoeda();Formzin.vCampo();Formzin.validar(jQuery(".validar-email"),Formzin.validarEmail,"Por favor preenchar um e-mail v&aacute;lido.");Formzin.validar(jQuery(".validar-url"),Formzin.validarUrl,"Por favor preenchar uma url v&aacute;lida.");Formzin.validar(jQuery(".validar-cpf"),Formzin.validarCpf,"Por favor preenchar o CPF corretamente.");Formzin.validar(jQuery(".validar-cnpj"),Formzin.validarCnpj,"Por favor preenchar o CNPJ corretamente.");Formzin.validar(jQuery(".validar-data"),Formzin.validarData,"Por favor preenchar a data corretamente.");Formzin.mBuscarEndereco()})},formatar:function(e,t){e.val(Formzin.formatarCampo(e,t));if(t=="caixa_alta")jQuery(".caixa_alta").attr("style","text-transform: uppercase;");e.bind("keyup",function(){var e=jQuery(this).val();if(t=="inteiro"){e=e.replace(/\D/g,"")}else if(t=="mascara"){e=Formzin.formatarCampo(jQuery(this),jQuery(this).attr("formato"))}else if(t=="caixa_alta"){e=e.toUpperCase()}else if(t=="data"){var n=jQuery(this).attr("separador");if(!n)n="/";e=Formzin.formatarCampo(jQuery(this),"00"+n+"00"+n+"0000")}else{e=Formzin.formatarCampo(jQuery(this),t)}jQuery(this).val(e)})},fMoeda:function(){var e=jQuery(".moeda");e.bind("keydown keyup",function(){var e=jQuery(this);var t=e.attr("prefixo")?e.attr("prefixo"):"";var n=e.attr("decimal")?e.attr("decimal"):",";var r=e.attr("milhar")?e.attr("milhar"):".";var i=false;var s=e.attr("limite_decimal")?parseInt(e.attr("limite_decimal")):2;var o="";var u="";var a=e.val();var f=/[0-9]/;for(var l=0;l<a.length;l++){char=a.substr(l,1);if(o.length==0&&char==0)char=false;if(char&&char.match(f)){if(i){if(o.length<i)o=o+char}else{o=o+char}}}while(o.length<s+1)o="0"+o;var c=o.substr(o.length-s,s);var h=o.substr(0,o.length-s);o=h+n+c;if(r){var p=0;for(var d=h.length;d>0;d--){char=h.substr(d-1,1);p++;if(p%3==0)char=r+char;u=char+u}if(u.substr(0,1)==r)u=u.substring(1,u.length);o=u+n+c}if(t)o=t+o;jQuery(this).val(o)})},vCampo:function(){var e=jQuery(".validar-campo");e.bind("blur focus keydown keyup change",function(){var e=jQuery(this).val();var t=jQuery(this).attr("id");jQuery(this).removeAttr("style","border: 1px solid red;");jQuery(this).removeClass("campo-validacao");jQuery(".error-validacao-"+t).remove();if(e==""){jQuery(this).attr("style","border: 1px solid red;");jQuery(this).addClass("campo-validacao");jQuery(".error-validacao-"+t).remove();if(jQuery(this).attr("msn_validacao"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+jQuery(this).attr("msn_validacao")+"</span>");else jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar campo.</span>')}else if(jQuery(this).attr("minlength")){if(jQuery(this).val().length<jQuery(this).attr("minlength"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor o campo deve ter no m&iacute;nimo ('+jQuery(this).attr("minlength")+") caracteres.</span>")}else if(jQuery(this).attr("maxlength")){if(jQuery(this).val().length>jQuery(this).attr("maxlength"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor o campo deve ter no m&aacute;ximo ('+jQuery(this).attr("maxlength")+") caracteres.</span>")}})},validar:function(e,t,n){e.bind("keydown keyup change",function(){var e=jQuery(this).val();valido=t(e);Formzin.msnValidacao(jQuery(this),valido,n)})},mBuscarEndereco:function(){jQuery(".buscar_endereco").change(function(){var e=jQuery(this);jQuery.getJSON("http://cep.republicavirtual.com.br/web_cep.php?cep="+e.val()+"&formato=json",function(t){if(t.resultado==="1"){jQuery("."+e.attr("prefixo")+"bairro").val(t.bairro);jQuery("."+e.attr("prefixo")+"cidade").val(t.cidade);jQuery("."+e.attr("prefixo")+"logradouro").val(t.tipo_logradouro+" "+t.logradouro);jQuery("."+e.attr("prefixo")+"uf").val(t.uf)}})})},msnValidacao:function(e,t,n){var r=e.attr("id");if(t==false){jQuery(".error-validacao-"+r).remove();e.attr("style","border: 1px solid red;");e.addClass("campo-validacao-"+r);if(e.attr("msn_validacao"))e.after('<span class="error-validacao error-validacao-'+r+'" style="color:red;">'+e.attr("msn_validacao")+"</span>");else e.after('<span class="error-validacao error-validacao-'+r+'" style="color:red;">'+n+"</span>")}else{e.removeAttr("style","border: 1px solid red;");e.removeClass("campo-validacao-"+r);jQuery(".error-validacao-"+r).remove()}},formatarCampo:function(e,t,n){var r={0:{pattern:/\d/},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}};var i=[],s=e.val(),o=0,u=t.length,a=0,f=s.length,l=1,c="push",h,p;h=u-1;p=function(){return o<u&&a<f};while(p()){var d=t.charAt(o),v=s.charAt(a),m=r[d];if(m){if(v.match(m.pattern)){i[c](v);o+=l}else if(m.optional){o+=l;a-=l}a+=l}else{if(n===undefined){i[c](d)}if(v===d){a+=l}o+=l}}return i.join("")},validarEmail:function(e){var t=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;if(!t.test(e))return false;return true},validarUrl:function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;if(t.test(e))return true;else return false},validarCpf:function(e){e=e.replace(/[^\d]+/g,"");if(e=="")return false;if(e.length!=11||e=="00000000000"||e=="11111111111"||e=="22222222222"||e=="33333333333"||e=="44444444444"||e=="55555555555"||e=="66666666666"||e=="77777777777"||e=="88888888888"||e=="99999999999")return false;add=0;for(i=0;i<9;i++)add+=parseInt(e.charAt(i))*(10-i);rev=11-add%11;if(rev==10||rev==11)rev=0;if(rev!=parseInt(e.charAt(9)))return false;add=0;for(i=0;i<10;i++)add+=parseInt(e.charAt(i))*(11-i);rev=11-add%11;if(rev==10||rev==11)rev=0;if(rev!=parseInt(e.charAt(10)))return false;return true},validarCnpj:function(e){e=e.replace(/[^\d]+/g,"");if(e=="")return false;if(e.length!=14)return false;if(e=="00000000000000"||e=="11111111111111"||e=="22222222222222"||e=="33333333333333"||e=="44444444444444"||e=="55555555555555"||e=="66666666666666"||e=="77777777777777"||e=="88888888888888"||e=="99999999999999")return false;tamanho=e.length-2;numeros=e.substring(0,tamanho);digitos=e.substring(tamanho);soma=0;pos=tamanho-7;for(i=tamanho;i>=1;i--){soma+=numeros.charAt(tamanho-i)*pos--;if(pos<2)pos=9}resultado=soma%11<2?0:11-soma%11;if(resultado!=digitos.charAt(0))return false;tamanho=tamanho+1;numeros=e.substring(0,tamanho);soma=0;pos=tamanho-7;for(i=tamanho;i>=1;i--){soma+=numeros.charAt(tamanho-i)*pos--;if(pos<2)pos=9}resultado=soma%11<2?0:11-soma%11;if(resultado!=digitos.charAt(1))return false;return true},validarData:function(e){var t=e;if(t=="")return false;var n=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/;var r=t.match(n);if(r==null)return false;dtMonth=r[3];dtDay=r[1];dtYear=r[5];if(dtMonth<1||dtMonth>12)return false;else if(dtDay<1||dtDay>31)return false;else if((dtMonth==4||dtMonth==6||dtMonth==9||dtMonth==11)&&dtDay==31)return false;else if(dtMonth==2){var i=dtYear%4==0&&(dtYear%100!=0||dtYear%400==0);if(dtDay>29||dtDay==29&&!i)return false}return true}};Formzin.iniciar()