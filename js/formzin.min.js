/* ========================================================================
 * Formzin: formzin.js v0.1
 * http://brunobrasilweb.github.io/Formzin.js
 * ========================================================================
 * Copyright (c) 2013 @brunobrasilweb.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * thtp://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================================== */
var Formzin={iniciar:function(){jQuery(document).ready(function(){Formzin.formatacao();Formzin.validacaoReal();Formzin.manipulacao()})},validacaoReal:function(){Formzin.vCampo();Formzin.vCpf();Formzin.vCnpj();Formzin.vData()},formatacao:function(){Formzin.fCpf();Formzin.fCnpj();Formzin.fInteiro();Formzin.fData();Formzin.fCep();Formzin.fMoeda();Formzin.fCaixaAlta();Formzin.fTelefone();Formzin.fCartaoCredito();Formzin.fMascara()},manipulacao:function(){Formzin.mBuscarEndereco()},fMascara:function(){var e=jQuery(".mascara");e.bind("keyup",function(){var e=jQuery(this).val();e=Formzin.formatarCampo(jQuery(this),jQuery(this).attr("formato"));jQuery(this).val(e)})},fCpf:function(){var e=jQuery(".cpf");e.attr("maxlength","14");e.bind("keyup",function(){var e=jQuery(this).val();e=Formzin.formatarCampo(jQuery(this),"000.000.000-00");jQuery(this).val(e)})},fCnpj:function(){var e=jQuery(".cnpj");e.attr("maxlength","18");e.bind("keyup",function(){var e=jQuery(this).val();e=Formzin.formatarCampo(jQuery(this),"00.000.000/0000-00");jQuery(this).val(e)})},fInteiro:function(){jQuery(".inteiro").bind("keydown keyup",function(){var e=jQuery(this).val().replace(/\D/g,"");jQuery(this).val(e)})},fData:function(){var e=jQuery(".data");e.attr("maxlength","10");e.bind("keyup",function(){var e=jQuery(this).attr("separador");var t=jQuery(this).val();if(!e)e="/";t=Formzin.formatarCampo(jQuery(this),"00"+e+"00"+e+"0000");jQuery(this).val(t)})},fCep:function(){var e=jQuery(".cep");e.attr("maxlength","9");e.bind("keyup",function(){var e=jQuery(this).val();e=Formzin.formatarCampo(jQuery(this),"00000-000");jQuery(this).val(e)})},fCaixaAlta:function(){var e=jQuery(".caixa_alta");e.attr("style","text-transform: uppercase;");e.bind("keydown keyup",function(){var e=jQuery(this).val();e=e.toUpperCase();jQuery(this).val(e)})},fTelefone:function(){var e=jQuery(".telefone");e.attr("maxlength","15");e.bind("keyup",function(){var e=jQuery(this).val();e=Formzin.formatarCampo(jQuery(this),"(00) 0000-00000");jQuery(this).val(e)})},fCartaoCredito:function(){var e=jQuery(".cartao_credito");e.attr("maxlength","19");e.bind("keyup",function(){var e=jQuery(this).val();e=Formzin.formatarCampo(jQuery(this),"0000 0000 0000 0000");jQuery(this).val(e)})},fMoeda:function(){var e=jQuery(".moeda");e.bind("keydown keyup",function(){var e=jQuery(this);var t=e.attr("prefixo")?e.attr("prefixo"):"";var n=e.attr("decimal")?e.attr("decimal"):",";var r=e.attr("milhar")?e.attr("milhar"):".";var i=false;var s=e.attr("limite_decimal")?parseInt(e.attr("limite_decimal")):2;var o="";var u="";var a=e.val();var f=/[0-9]/;for(var l=0;l<a.length;l++){char=a.substr(l,1);if(o.length==0&&char==0)char=false;if(char&&char.match(f)){if(i){if(o.length<i)o=o+char}else{o=o+char}}}while(o.length<s+1)o="0"+o;var c=o.substr(o.length-s,s);var h=o.substr(0,o.length-s);o=h+n+c;if(r){var p=0;for(var d=h.length;d>0;d--){char=h.substr(d-1,1);p++;if(p%3==0)char=r+char;u=char+u}if(u.substr(0,1)==r)u=u.substring(1,u.length);o=u+n+c}if(t)o=t+o;jQuery(this).val(o)})},vCampo:function(){var e=jQuery(".validar-campo");e.bind("blur focus keydown keyup change",function(){var e=jQuery(this).val();var t=jQuery(this).attr("id");jQuery(this).removeAttr("style","border: 1px solid red;");jQuery(this).removeClass("campo-validacao");jQuery(".error-validacao-"+t).remove();if(e==""){jQuery(this).attr("style","border: 1px solid red;");jQuery(this).addClass("campo-validacao");jQuery(".error-validacao-"+t).remove();if(jQuery(this).attr("msn_validacao"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+jQuery(this).attr("msn_validacao")+"</span>");else jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar o CPF corretamente.</span>')}else if(jQuery(this).attr("minlength")){if(jQuery(this).val().length<jQuery(this).attr("minlength"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor o campo deve ter no mínimo ('+jQuery(this).attr("minlength")+") caracteres.</span>")}else if(jQuery(this).attr("maxlength")){if(jQuery(this).val().length>jQuery(this).attr("maxlength"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor o campo deve ter no máximo ('+jQuery(this).attr("maxlength")+") caracteres.</span>")}})},vCpf:function(){var e=jQuery(".validar-cpf");e.attr("maxlength","14");e.bind("keydown keyup change",function(){var e=jQuery(this).val();var t=jQuery(this).attr("id");valido=Formzin.validarCpf(e);if(valido==false){jQuery(".error-validacao-"+t).remove();jQuery(this).attr("style","border: 1px solid red;");jQuery(this).addClass("campo-validacao-"+t);if(jQuery(this).attr("msn_validacao"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+jQuery(this).attr("msn_validacao")+"</span>");else jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar o CPF corretamente.</span>')}else{jQuery(this).removeAttr("style","border: 1px solid red;");jQuery(this).removeClass("campo-validacao-"+t);jQuery(".error-validacao-"+t).remove()}})},vCnpj:function(){var e=jQuery(".validar-cnpj");e.bind("keydown keyup change",function(){var e=jQuery(this).val();var t=jQuery(this).attr("id");valido=Formzin.validarCnpj(e);if(valido==false){jQuery(".error-validacao-"+t).remove();jQuery(this).attr("style","border: 1px solid red;");jQuery(this).addClass("campo-validacao-"+t);if(jQuery(this).attr("msn_validacao"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+jQuery(this).attr("msn_validacao")+"</span>");else jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar o CNPJ corretamente.</span>')}else{jQuery(this).removeAttr("style","border: 1px solid red;");jQuery(this).removeClass("campo-validacao-"+t);jQuery(".error-validacao-"+t).remove()}})},vData:function(){var e=jQuery(".validar-data");e.bind("keydown keyup change",function(){var e=jQuery(this).val();var t=jQuery(this).attr("id");valido=Formzin.validarData(e);if(valido==false){jQuery(".error-validacao-"+t).remove();jQuery(this).attr("style","border: 1px solid red;");jQuery(this).addClass("campo-validacao-"+t);if(jQuery(this).attr("msn_validacao"))jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+jQuery(this).attr("msn_validacao")+"</span>");else jQuery(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar a data corretamente.</span>')}else{jQuery(this).removeAttr("style","border: 1px solid red;");jQuery(this).removeClass("campo-validacao-"+t);jQuery(".error-validacao-"+t).remove()}})},mBuscarEndereco:function(){jQuery(".buscar_endereco").change(function(){var e=jQuery(this);jQuery.getJSON("http://cep.republicavirtual.com.br/web_cep.php?cep="+e.val()+"&formato=json",function(t){if(t.resultado==="1"){jQuery("."+e.attr("prefixo")+"bairro").val(t.bairro);jQuery("."+e.attr("prefixo")+"cidade").val(t.cidade);jQuery("."+e.attr("prefixo")+"logradouro").val(t.tipo_logradouro+" "+t.logradouro);jQuery("."+e.attr("prefixo")+"uf").val(t.uf)}})})},formatarCampo:function(e,t,n){try{var r=e.val();try{var i=n.which?n.which:event.keyCode;if(i==46||i==8){e.val("");return}}catch(s){}var o=/[0\*]/;var u=/[0-9]/;var a="";for(var f=0,l=0;l<t.length;){if(l>=r.length)break;if(t[l]=="0"&&r[f].match(u)==null){break}while(t[l].match(o)==null){if(r[f]==t[l])break;a+=t[l++]}a+=r[f++];l++}return a}catch(i){}},validarCpf:function(e){e=e.replace(/[^\d]+/g,"");if(e=="")return false;if(e.length!=11||e=="00000000000"||e=="11111111111"||e=="22222222222"||e=="33333333333"||e=="44444444444"||e=="55555555555"||e=="66666666666"||e=="77777777777"||e=="88888888888"||e=="99999999999")return false;add=0;for(i=0;i<9;i++)add+=parseInt(e.charAt(i))*(10-i);rev=11-add%11;if(rev==10||rev==11)rev=0;if(rev!=parseInt(e.charAt(9)))return false;add=0;for(i=0;i<10;i++)add+=parseInt(e.charAt(i))*(11-i);rev=11-add%11;if(rev==10||rev==11)rev=0;if(rev!=parseInt(e.charAt(10)))return false;return true},validarCnpj:function(e){e=e.replace(/[^\d]+/g,"");if(e=="")return false;if(e.length!=14)return false;if(e=="00000000000000"||e=="11111111111111"||e=="22222222222222"||e=="33333333333333"||e=="44444444444444"||e=="55555555555555"||e=="66666666666666"||e=="77777777777777"||e=="88888888888888"||e=="99999999999999")return false;tamanho=e.length-2;numeros=e.substring(0,tamanho);digitos=e.substring(tamanho);soma=0;pos=tamanho-7;for(i=tamanho;i>=1;i--){soma+=numeros.charAt(tamanho-i)*pos--;if(pos<2)pos=9}resultado=soma%11<2?0:11-soma%11;if(resultado!=digitos.charAt(0))return false;tamanho=tamanho+1;numeros=e.substring(0,tamanho);soma=0;pos=tamanho-7;for(i=tamanho;i>=1;i--){soma+=numeros.charAt(tamanho-i)*pos--;if(pos<2)pos=9}resultado=soma%11<2?0:11-soma%11;if(resultado!=digitos.charAt(1))return false;return true},validarData:function(e){regex=/^((((0?[1-9]|1\d|2[0-8])\/(0?[1-9]|1[0-2]))|((29|30)\/(0?[13456789]|1[0-2]))|(31\/(0?[13578]|1[02])))\/((19|20)?\d\d))jQuery|((29\/0?2\/)((19|20)?(0[48]|[2468][048]|[13579][26])|(20)?00))jQuery/;resultado=regex.exec(e);if(!resultado)return false;else return true}};Formzin.iniciar()