/* ========================================================================
 * Formzin: formzin.js v0.1
 * http://formzin.com
 * ========================================================================
 * Copyright (c) 2013 @brunobrasilweb.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * thtp://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================================== */
function formatarCampo(e,t,n){try{var r=e.val();try{var i=n.which?n.which:event.keyCode;if(i==46||i==8){e.val("");return}}catch(s){}var o=/[0\*]/;var u=/[0-9]/;var a="";for(var f=0,l=0;l<t.length;){if(l>=r.length)break;if(t[l]=="0"&&r[f].match(u)==null){break}while(t[l].match(o)==null){if(r[f]==t[l])break;a+=t[l++]}a+=r[f++];l++}return a}catch(i){}}function validarCpf(e){e=e.replace(/[^\d]+/g,"");if(e=="")return false;if(e.length!=11||e=="00000000000"||e=="11111111111"||e=="22222222222"||e=="33333333333"||e=="44444444444"||e=="55555555555"||e=="66666666666"||e=="77777777777"||e=="88888888888"||e=="99999999999")return false;add=0;for(i=0;i<9;i++)add+=parseInt(e.charAt(i))*(10-i);rev=11-add%11;if(rev==10||rev==11)rev=0;if(rev!=parseInt(e.charAt(9)))return false;add=0;for(i=0;i<10;i++)add+=parseInt(e.charAt(i))*(11-i);rev=11-add%11;if(rev==10||rev==11)rev=0;if(rev!=parseInt(e.charAt(10)))return false;return true}function validarCnpj(e){e=e.replace(/[^\d]+/g,"");if(e=="")return false;if(e.length!=14)return false;if(e=="00000000000000"||e=="11111111111111"||e=="22222222222222"||e=="33333333333333"||e=="44444444444444"||e=="55555555555555"||e=="66666666666666"||e=="77777777777777"||e=="88888888888888"||e=="99999999999999")return false;tamanho=e.length-2;numeros=e.substring(0,tamanho);digitos=e.substring(tamanho);soma=0;pos=tamanho-7;for(i=tamanho;i>=1;i--){soma+=numeros.charAt(tamanho-i)*pos--;if(pos<2)pos=9}resultado=soma%11<2?0:11-soma%11;if(resultado!=digitos.charAt(0))return false;tamanho=tamanho+1;numeros=e.substring(0,tamanho);soma=0;pos=tamanho-7;for(i=tamanho;i>=1;i--){soma+=numeros.charAt(tamanho-i)*pos--;if(pos<2)pos=9}resultado=soma%11<2?0:11-soma%11;if(resultado!=digitos.charAt(1))return false;return true}function validarData(e){regex=/^((((0?[1-9]|1\d|2[0-8])\/(0?[1-9]|1[0-2]))|((29|30)\/(0?[13456789]|1[0-2]))|(31\/(0?[13578]|1[02])))\/((19|20)?\d\d))$|((29\/0?2\/)((19|20)?(0[48]|[2468][048]|[13579][26])|(20)?00))$/;resultado=regex.exec(e);if(!resultado)return false;else return true}var Formzin={iniciar:function(){$(document).ready(function(){Formzin.formatacao();Formzin.validacaoReal();Formzin.manipulacao()})},validacaoReal:function(){Formzin.vCampo();Formzin.vCpf();Formzin.vCnpj();Formzin.vData()},formatacao:function(){Formzin.fCpf();Formzin.fCnpj();Formzin.fInteiro();Formzin.fData();Formzin.fCep();Formzin.fMoeda();Formzin.fCaixaAlta();Formzin.fMascara()},manipulacao:function(){Formzin.mBuscarEndereco()},fMascara:function(){var e=$(".mascara");e.bind("keyup",function(){var e=$(this).val();e=formatarCampo($(this),$(this).attr("formato"));$(this).val(e)})},fCpf:function(){var e=$(".cpf");e.attr("maxlength","14");e.bind("keyup",function(){var e=$(this).val();e=formatarCampo($(this),"000.000.000-00");$(this).val(e)})},fCnpj:function(){var e=$(".cnpj");e.attr("maxlength","18");e.bind("keyup",function(){var e=$(this).val();e=formatarCampo($(this),"00.000.000/0000-00");$(this).val(e)})},fInteiro:function(){$(".inteiro").bind("keydown keyup",function(){var e=$(this).val().replace(/\D/g,"");$(this).val(e)})},fData:function(){var e=$(".data");e.attr("maxlength","10");e.bind("keyup",function(){var e=$(this).attr("separador");var t=$(this).val();if(!e)e="/";t=formatarCampo($(this),"00"+e+"00"+e+"0000");$(this).val(t)})},fCep:function(){var e=$(".cep");e.attr("maxlength","9");e.bind("keyup",function(){var e=$(this).val();e=formatarCampo($(this),"00000-000");$(this).val(e)})},fCaixaAlta:function(){var e=$(".caixa_alta");e.attr("style","text-transform: uppercase;");e.bind("keydown keyup",function(){var e=$(this).val();e=e.toUpperCase();$(this).val(e)})},fMoeda:function(){var e=$(".moeda");e.bind("keydown keyup",function(){var e=$(this);var t=e.attr("prefixo")?e.attr("prefixo"):"";var n=e.attr("decimal")?e.attr("decimal"):",";var r=e.attr("milhar")?e.attr("milhar"):".";var i=false;var s=e.attr("limite_decimal")?parseInt(e.attr("limite_decimal")):2;var o="";var u="";var a=e.val();var f=/[0-9]/;for(var l=0;l<a.length;l++){char=a.substr(l,1);if(o.length==0&&char==0)char=false;if(char&&char.match(f)){if(i){if(o.length<i)o=o+char}else{o=o+char}}}while(o.length<s+1)o="0"+o;var c=o.substr(o.length-s,s);var h=o.substr(0,o.length-s);o=h+n+c;if(r){var p=0;for(var d=h.length;d>0;d--){char=h.substr(d-1,1);p++;if(p%3==0)char=r+char;u=char+u}if(u.substr(0,1)==r)u=u.substring(1,u.length);o=u+n+c}if(t)o=t+o;$(this).val(o)})},vCampo:function(){var e=$(".validar-campo");e.bind("blur focus keydown keyup change",function(){var e=$(this).val();var t=$(this).attr("id");$(this).removeAttr("style","border: 1px solid red;");$(this).removeClass("campo-validacao");$(".error-validacao-"+t).remove();if(e==""){$(this).attr("style","border: 1px solid red;");$(this).addClass("campo-validacao");$(".error-validacao-"+t).remove();if($(this).attr("msn_validacao"))$(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+$(this).attr("msn_validacao")+"</span>");else $(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar o CPF corretamente.</span>')}else if($(this).attr("minlength")){if($(this).val().length<$(this).attr("minlength"))$(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor o campo deve ter no minimo ('+$(this).attr("minlength")+") caracteres.</span>")}else if($(this).attr("maxlength")){if($(this).val().length>$(this).attr("maxlength"))$(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor o campo deve ter no m√°ximo ('+$(this).attr("maxlength")+") caracteres.</span>")}})},vCpf:function(){var e=$(".validar-cpf");e.attr("maxlength","14");e.bind("keydown keyup change",function(){var e=$(this).val();var t=$(this).attr("id");valido=validarCpf(e);if(valido==false){$(".error-validacao-"+t).remove();$(this).attr("style","border: 1px solid red;");$(this).addClass("campo-validacao-"+t);if($(this).attr("msn_validacao"))$(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+$(this).attr("msn_validacao")+"</span>");else $(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar o CPF corretamente.</span>')}else{$(this).removeAttr("style","border: 1px solid red;");$(this).removeClass("campo-validacao-"+t);$(".error-validacao-"+t).remove()}})},vCnpj:function(){var e=$(".validar-cnpj");e.bind("keydown keyup change",function(){var e=$(this).val();var t=$(this).attr("id");valido=validarCnpj(e);if(valido==false){$(".error-validacao-"+t).remove();$(this).attr("style","border: 1px solid red;");$(this).addClass("campo-validacao-"+t);if($(this).attr("msn_validacao"))$(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+$(this).attr("msn_validacao")+"</span>");else $(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar o CNPJ corretamente.</span>')}else{$(this).removeAttr("style","border: 1px solid red;");$(this).removeClass("campo-validacao-"+t);$(".error-validacao-"+t).remove()}})},vData:function(){var e=$(".validar-data");e.bind("keydown keyup change",function(){var e=$(this).val();var t=$(this).attr("id");valido=validarData(e);if(valido==false){$(".error-validacao-"+t).remove();$(this).attr("style","border: 1px solid red;");$(this).addClass("campo-validacao-"+t);if($(this).attr("msn_validacao"))$(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">'+$(this).attr("msn_validacao")+"</span>");else $(this).after('<span class="error-validacao error-validacao-'+t+'" style="color:red;">Por favor preenchar a data corretamente.</span>')}else{$(this).removeAttr("style","border: 1px solid red;");$(this).removeClass("campo-validacao-"+t);$(".error-validacao-"+t).remove()}})},mBuscarEndereco:function(){$(".buscar_endereco").change(function(){var e=$(this);$.getJSON("http://cep.republicavirtual.com.br/web_cep.php?cep="+e.val()+"&formato=json",function(t){if(t.resultado==="1"){$("."+e.attr("prefixo")+"bairro").val(t.bairro);$("."+e.attr("prefixo")+"cidade").val(t.cidade);$("."+e.attr("prefixo")+"logradouro").val(t.tipo_logradouro+" "+t.logradouro);$("."+e.attr("prefixo")+"uf").val(t.uf)}})})}};Formzin.iniciar()